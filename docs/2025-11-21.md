# Vercel 部署指南（outdoor-trails-hub）

## 目標
將現有 Next.js 專案（已使用 Supabase REST、無 Drizzle/TCP 依賴）部署到 Vercel，避免 Cloudflare Workers 的 TCP 限制與本地網路封鎖問題。

## 必備環境變數
- `NEXT_PUBLIC_SUPABASE_URL`：例如 `https://<project>.supabase.co`
- `NEXT_PUBLIC_SUPABASE_ANON_KEY`：Supabase anon key（前端可用）
- `SUPABASE_SERVICE_ROLE_KEY`：Supabase service_role key（僅 Server/API 使用）
- 建議：`NEXT_PUBLIC_SITE_URL` 指向 Vercel 網域或自訂網域（供前端組裝絕對路徑）

## 部署步驟
1) 將程式碼推到 GitHub/GitLab。  
2) Vercel Import 專案，Root 設 `/`，Framework 選 Next.js。  
3) Build Command：`npm run build`（預設即可），Output 保持預設。  
4) 在 Vercel 的 Environment Variables 填入上述鍵值（至少 Production/Preview）。  
5) 點 Deploy，完成後取得 preview/production 網址。

## 部署後煙囪測試
- API：`/api/trips`、`/api/equipment`、`/api/categories`（CRUD 需帶 session，未授權應回 401/403 而非 500）。
- 頁面：`/GearDashboard`、`/TripDashboard`、`/Profile`、`/profile/[username]`。  
- OAuth：在 Supabase Dashboard 設定 Vercel 網域的 callback/redirect，驗證登入流程。

## 本地驗證（可選）
- `.env.local`（或 `.dev.vars`）也填上述變數。  
- `npm run build` 確認無型別/規則錯誤。  
- `npm run dev` 時需可對外連線，否則 middleware 的 Supabase Auth 會噴 `fetch failed`。

## 常見問題
- `SUPABASE_SERVICE_ROLE_KEY is not defined`：環境變數未設定或未被 Vercel 注入，請到 Vercel Env 再次確認。  
- middleware 出現 `fetch failed`：通常是本地無網路或 Supabase URL/Key 填錯；在 Vercel 只要變數正確即可。  
- Edge Runtime 警告（Supabase Realtime/SSR）：可暫忽或在特定 handler 標記 `runtime: 'nodejs'`。  
